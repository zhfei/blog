{{extend '../_layouts/home.html'}}

{{block 'title'}}{{'多人博客 - 首页'}}{{/block}}

{{block 'head'}}
<link rel="stylesheet" href="/public/css/markdown-github.css">
<style>
    .panel .panel-heading .action i {
        margin-right: 10px;
    }
</style>
{{/block}}

{{block 'body'}}
<section class="container">
    <div class="row">
        <div class="col-md-9">
            <article class="markdown-body">
                <h1 id="_1"><a name="user-content-_1" href="#_1" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>{{topic.title}}</h1>
                <blockquote>
                    <p>{{topic.content}}</p>
                </blockquote>
                <h2 id="_2"><a name="user-content-_2" href="#_2" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>起步</h2>
                <ul>
                    <li>123</li>
                    <li>456</li>
                    <li>789</li>
                </ul>
                <h3 id="_3"><a name="user-content-_3" href="#_3" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>哈哈哈</h3>
                <p>然后这里就开始 <code>hello world</code> ，就用可以了。</p>
                <p>下面是一段代码：</p>
                <pre><code class="javascript">var foo = 'bar'
  console.log(foo)
  </code></pre>
                <h3 id="_4"><a name="user-content-_4" href="#_4" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>嘿嘿</h3>
                <h3 id="_5"><a name="user-content-_5" href="#_5" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>呼呼</h3>
                <h2 id="_6"><a name="user-content-_6" href="#_6" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>是什么</h2>
                <h2 id="_7"><a name="user-content-_7" href="#_7" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>为什么</h2>
                <h2 id="_8"><a name="user-content-_8" href="#_8" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>怎么做</h2>
                <h2 id="_9"><a name="user-content-_9" href="#_9" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>哈哈哈</h2>
            </article>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span>lipengzhou</span> commented
                    <span>24 minutes ago</span>
                    <span class="action">
            <a href=""><i class="glyphicon glyphicon-thumbs-up pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
          </span>
                </div>
                <div class="panel-body">
                    评论测试
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span>lipengzhou</span> commented
                    <span>24 minutes ago</span>
                    <span class="action">
            <a href=""><i class="glyphicon glyphicon-thumbs-up pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
          </span>
                </div>
                <div class="panel-body">
                    评论测试
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span>lipengzhou</span> commented
                    <span>24 minutes ago</span>
                    <span class="action">
            <a href=""><i class="glyphicon glyphicon-thumbs-up pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
          </span>
                </div>
                <div class="panel-body">
                    评论测试
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span>lipengzhou</span> commented
                    <span>24 minutes ago</span>
                    <span class="action">
            <a href=""><i class="glyphicon glyphicon-thumbs-up pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
          </span>
                </div>
                <div class="panel-body">
                    评论测试
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <span>lipengzhou</span> commented
                    <span>24 minutes ago</span>
                    <span class="action">
            <a href=""><i class="glyphicon glyphicon-thumbs-up pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
            <a href=""><i class="glyphicon glyphicon-remove-circle pull-right"></i></a>
          </span>
                </div>
                <div class="panel-body">
                    评论测试
                </div>
            </div>
            <hr>
            <form id="add_replay_form" method="post">
                <input type="text" name="topicId" value="{{topic.id}}" hidden>
                <input type="text" name="replyEmail" value="{{topic.email}}" hidden>
                <input type="text" name="replyNickname" value="{{topic.nickname}}" hidden>
                <div class="form-group">
                    <label for="exampleInputPassword1">添加回复</label>
                    <textarea class="form-control" name="replyContent" id="" cols="10" rows="10"></textarea>
                </div>

                {{if user}}
                <button type="submit" class="btn btn-success">回复</button>
                {{else}}
                <button type="submit" class="btn btn-default" disabled>回复</button>
                {{/if}}

            </form>
        </div>
    </div>
</section>
{{/block}}


{{block 'script'}}
<script>
    $('#add_replay_form').on('submit', function (event) {
        //阻止默认提交事件，自定义异步提交
        event.preventDefault()
        var formData = $(this).serialize()
        console.log(formData)
        $.ajax({
            url:'/topic/add_replay',
            type:'post',
            data:formData,
            dataType:'json',
            success:function (data) {
                console.log(data)
                var err_code = data.err_code
                if (err_code === 0) {
                    //异步请求，服务器重定向无效
                    window.location.href = '/'
//                    window.alert('回复成功')
                } else if (err_code === 1){
                    window.alert('邮箱或密码错误')
                } else if (err_code === 500){
                    window.alert('服务器忙，请稍后重试')
                }
            }
        })

    })
</script>
{{/block}}
